try{Array.prototype.del=function(f){f.sort();for(var d=this.concat([]),g=f.length-1;g>=0;g--){d=d.slice(0,f[g]).concat(d.slice(f[g]+1))}return d},HTMLImageElement.prototype.loadOnce=function(d){var c=0;this.onload=function(){c||d.call(this,null),c++}},function(d){var c={lib:[],init:function(){this.require("config")},module:function(g,f){this.lib[g]=f.call(null,this)},require:function(g){var f=this,h=document.createElement("script");document.body.appendChild(h),h.src="./js/module/"+g+".js",h.onload=h.onerror=function(b){f.handlerror(b)}},handlerror:function(){},destroySelf:function(a){throw delete ShearPhoto[d],Error(a)},reflect:function(g,f,h){return g=this.lib.config.getModuleName(g),this.lib[g].process(f,h)},reflectEasy:function(b){return b=this.lib.config.getEasyFun(b),this.lib.easy.getFun(b)},add:function(j,i,p,o,n,m,l,k){return this.lib.addLayer.add(j,i,p,o,n,m,l,k)},applyMatrix:function(){}};ShearPhoto[d]=function(a,n,m){if(!(this instanceof ShearPhoto[d])){return new ShearPhoto[d](a,n,m)}this.startTime=+new Date();var j,i,l=document.createElement("canvas"),k=l.getContext("2d");isNaN(a)?(l.width=parseInt(a.width),l.height=parseInt(a.height),n=getComputedStyle(a),j=parseInt(n.getPropertyValue("width")),i=parseInt(n.getPropertyValue("height")),isNaN(j)?k.drawImage(a,0,0):k.drawImage(a,0,0,j,i)):(l.width=a,l.height=n,k.fillStyle=m||"#fff",k.fillRect(0,0,a,n)),this.canvas=l,this.context=k,this.imgData=k.getImageData(0,0,l.width,l.height),this.name=d+"_"+Math.random(),this.canvas.id=this.name,this.layers=[],a=document.createElement("canvas"),a.width=l.width,a.height=l.height},ShearPhoto[d].module=function(b,f){c.module(b,f)},ShearPhoto[d].dorsyMath=function(){return c.lib.dorsyMath},ShearPhoto[d].prototype={act:function(b){var f=[],f=Array.prototype.slice.call(arguments,1);return c.reflect(b,this.imgData,f),this},view:function(h,g,l,k,j){var i=this.clone();return i.type=1,this.addLayer(i,"\u6b63\u5e38",0,0),i.act(h,g,l,k,j),this},excute:function(){var g=this.layers,f=g.length;g[f-1]&&1==g[f-1][0].type&&(this.imgData=g[f-1][0].imgData,delete g[f-1])},cancel:function(){var g=this.layers,f=g.length;g[f-1]&&1==g[f-1][0].type&&delete g[f-1]},show:function(a,n){var m,l,k,j,i=new ShearPhoto[d](this.canvas.width,this.canvas.height);for(i.add(this,"\u6b63\u5e38",0,0,n),this.tempPsLib=i,m=0;m<this.layers.length;m++){l=this.layers[m],k=l[0].layers,j=l[0],k[k.length-1]&&1==k[k.length-1][0].type&&(j=k[k.length-1][0]),i.add(j,l[1],l[2],l[3],n)}return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.putImageData(i.imgData,0,0),a?document.querySelector(a).appendChild(this.canvas):document.body.appendChild(this.canvas),this},replace:function(b){return b&&(b.onload=function(){},b.src=this.save()),this},add:function(){var b,l,k,j,i,h=[];for(k=0;k<arguments.length;k++){if(k){switch(typeof arguments[k]){case"string":/\d+%/.test(arguments[k])?l=arguments[k].replace("%",""):/[RGB]+/.test(arguments[k])?i=arguments[k]:b=arguments[k];break;case"number":h.push(arguments[k]);break;case"boolean":j=arguments[k]}}}return k=h[0]||0,h=h[1]||0,this.imgData=c.add(this.imgData,arguments[0].imgData,b||"\u6b63\u5e38",l/100||1,k,h,j||!1,i||"RGB"),this},addLayer:function(g,f,i,h){return this.layers.push([g,f,i,h]),this},clone:function(){var a=new ShearPhoto[d](this.canvas.width,this.canvas.height);return a.context.putImageData(this.imgData,0,0),a.imgData=a.context.getImageData(0,0,this.canvas.width,this.canvas.height),a},swap:function(g,f){var h=this.layers[g];return this.layers[g]=this.layers[f],this.layers[f]=h,this},deleteLayers:function(b){this.layers=this.layers.del(b)},save:function(a,n){var m,l,k,j,i;if(!this.layers.length){return n?(this.context.putImageData(this.imgData,0,0),this.canvas.toDataURL(n,0.9)):(this.context.putImageData(this.imgData,0,0),this.canvas.toDataURL())}for(m=new ShearPhoto[d](this.canvas.width,this.canvas.height),m.add(this,"\u6b63\u5e38",0,0,a),this.tempPsLib=m,l=0;l<this.layers.length;l++){k=this.layers[l],j=k[0].layers,i=k[0],j[j.length-1]&&1==j[j.length-1][0].type&&(i=j[j.length-1][0]),m.add(i,k[1],k[2],k[3],a)}return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.putImageData(m.imgData,0,0),n?this.canvas.toDataURL(n,0.9):this.canvas.toDataURL()},drawRect:function(){var h,g,l,k,j,i;for((h=document.getElementById("imgRect"))||(h=document.createElement("canvas"),h.id="imgRect",document.body.appendChild(h),h.width=parseInt(this.canvas.width),h.height=parseInt(this.canvas.height)),g=h.getContext("2d"),g.clearRect(0,0,h.width,h.height),l=[],k=this.tempPsLib.imgData.data,j=0,i=k.length;i>j;j++){l[k[j]]?l[k[j]]++:l[k[j]]=1}for(g.beginPath(),g.moveTo(0,h.height),j=k=0;255>j;j++){l[j]>k&&(k=l[j])}for(j=0;255>j;j++){i=l[j]||0,i=h.height-0.8*(i/k)*h.height,g.lineTo(j/256*h.width,i,1,1)}g.lineTo(h.width+10,h.height),g.fill()},ps:function(b){var f;return f=c.reflectEasy(b).call(this),this.logTime("\u7ec4\u5408\u6548\u679c"+b),f},logTime:function(b){console.log(b+": "+(+new Date()-this.startTime)/1000+"s")},ctx:function(g){var f=this.ctxContext;return f.putImageData(this.imgData,0,0),g.call(f),this.imgData=f.getImageData(0,0,this.canvas.width,this.canvas.height),this}}}("psLib"),function(b){ShearPhoto[b].module("ImageEnhance",function(){return{process:function(g){for(var f=g.data,i=0,h=f.length;h>i;i+=4){}return g.data=f,g}}})}("psLib"),function(b){ShearPhoto[b].module("addLayer",function(){return{add:function(F,E,D,C,B,A,z,y){var x,w,v,u,t,s,r,q;for(z=F.data,x=E.data,B=B||0,A=A||0,C=C||1,y=y||"RGB",/[RGB]+/.test(y)||(y="RGB"),v=y.replace("R","0").replace("G","1").replace("B","2"),y=F.width,u=x.length,E=E.width,v=[-1<v.indexOf("0"),-1<v.indexOf("1"),-1<v.indexOf("2")],r=0,q=z.length;q>r;r+=4){if(t=r/4,s=parseInt(t/y),t%=y,s-=A,t-=B,s=s*E+t,s*=4,s>=0&&u-4>s&&E>t&&t>=0){for(t=0;3>t&&0!=x[s+3];t++){switch(z[r+3]=x[s+3],D){case"\u989c\u8272\u51cf\u6de1":v[t]&&(w=z[r+t]+z[r+t]*x[s+t]/(255-x[s+t]),z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u53d8\u6697":v[t]&&(w=z[r+t]<x[s+t]?z[r+t]:x[s+t],z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u53d8\u4eae":v[t]&&(w=z[r+t]>x[s+t]?z[r+t]:x[s+t],z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u6b63\u7247\u53e0\u5e95":v[t]&&(w=parseInt(z[r+t]*x[s+t]/255),z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u6ee4\u8272":v[t]&&(w=parseInt(255-(255-z[r+t])*(255-x[s+t])/255),z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u53e0\u52a0":v[t]&&(w=127.5>=z[r+t]?z[r+t]*x[s+t]/127.5:255-(255-z[r+t])*(255-x[s+t])/127.5,z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u5f3a\u5149":v[t]&&(w=127.5>=x[s+t]?z[r+t]*x[s+t]/127.5:z[r+t]+(255-z[r+t])*(x[s+t]-127.5)/127.5,z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u5dee\u503c":v[t]&&(w=z[r+t]>x[s+t]?z[r+t]-x[s+t]:x[s+t]-z[r+t],z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u6392\u9664":v[t]&&(w=z[r+t]+x[s+t]-z[r+t]*x[s+t]/127.5,z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u70b9\u5149":v[t]&&(w=z[r+t]<2*x[s+t]-255?2*x[s+t]-255:z[r+t]<2*x[s+t]?z[r+t]:2*x[s+t],z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u989c\u8272\u52a0\u6df1":v[t]&&(w=255-255*(255-z[r+t])/x[s+t],z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u7ebf\u6027\u52a0\u6df1":v[t]&&(w=z[r+t]+x[s+t],w=w>255?w-255:0,z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u7ebf\u6027\u51cf\u6de1":v[t]&&(w=z[r+t]+x[s+t],w=w>255?255:w,z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u67d4\u5149":v[t]&&(w=127.5>x[s+t]?((2*x[s+t]-255)*(255-z[r+t])/65025+1)*z[r+t]:(2*x[s+t]-255)*(Math.sqrt(z[r+t]/255)-z[r+t]/255)+z[r+t],z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u4eae\u5149":v[t]&&(w=127.5>x[s+t]?255*(1-(255-z[r+t])/(2*x[s+t])):z[r+t]/(2*(1-x[s+t]/255)),z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u7ebf\u6027\u5149":v[t]&&(w=z[r+t]+2*x[s+t]-255,w=w>255?255:w,z[r+t]=(1-C)*z[r+t]+C*w);break;case"\u5b9e\u8272\u6df7\u5408":v[t]&&(w=x[s+t]<255-z[r+t]?0:255,z[r+t]=(1-C)*z[r+t]+C*w);break;default:v[t]&&(w=x[s+t],z[r+t]=(1-C)*z[r+t]+C*w)}}}}return F}}})}("psLib"),function(b){ShearPhoto[b].module("brightness",function(){return{process:function(j,i){var p,o,n,m,l,k;for(p=j.data,o=i[0]/50,n=Math.tan((45+44*((i[1]||0)/50))*Math.PI/180),m=0,l=p.length;l>m;m+=4){for(k=0;3>k;k++){p[m+k]=(p[m+k]-127.5*(1-o))*n+127.5*(1+o)}}return j}}})}("psLib"),function(b){ShearPhoto[b].module("applyMatrix",function(c){return{process:function(D){var C,B,A,z,y,x,w,v,u,t,s,r,q,a;for(C=D.data,B=D.width,A=new c.lib.dorsyMath.Matrix([-2,-4,-4,-4,-2,-4,0,8,0,-4,-4,8,24,8,-4,-4,0,8,0,-4,-2,-4,-4,-4,-2],25,1),z=[],y=0,x=C.length;x>y;y+=4){if(w=y/4,v=parseInt(w/B),u=w%B,0!=v&&0!=u){for(t=[[],[],[]],s=-2;3>s;s++){for(r=v+s,q=-2;3>q;q++){for(a=4*(r*B+(u+q)),w=0;3>w;w++){t[w].push(C[a+w])}}}for(v=new c.lib.dorsyMath.Matrix(t,3,matrixSize).mutiply(A),w=0;3>w;w++){z[y+w]=v.data[w]}z[y+4]=C[y+4]}}for(y=0,x=C.length;x>y;y++){C[y]=z[y]||C[y]}return D}}})}("psLib"),function(b){ShearPhoto[b].module("config",function(){var d={"\u7070\u5ea6\u5904\u7406":"toGray","\u53cd\u8272":"toReverse","\u7070\u5ea6\u9608\u503c":"toThresh","\u9ad8\u65af\u6a21\u7cca":"gaussBlur","\u4eae\u5ea6":"brightness","\u6d6e\u96d5\u6548\u679c":"embossment","\u67e5\u627e\u8fb9\u7f18":"borderline","\u8272\u76f8/\u9971\u548c\u5ea6\u8c03\u8282":"setHSI","\u9a6c\u8d5b\u514b":"mosaic","\u6cb9\u753b":"oilPainting","\u8150\u8680":"corrode","\u9510\u5316":"sharp","\u6dfb\u52a0\u6742\u8272":"noise","\u66f2\u7ebf":"curve","\u6697\u89d2":"darkCorner","\u55b7\u70b9":"dotted"},c={"\u7f8e\u80a4":"softenFace","\u7d20\u63cf":"sketch","\u81ea\u7136\u589e\u5f3a":"softEnhancement","\u7d2b\u8c03":"purpleStyle","\u67d4\u7126":"soften","\u590d\u53e4":"vintage","\u9ed1\u767d":"gray","\u4efflomo":"lomo","\u4eae\u767d\u589e\u5f3a":"strongEnhancement","\u7070\u767d":"strongGray","\u7070\u8272":"lightGray","\u6696\u79cb":"warmAutumn","\u6728\u96d5":"carveStyle","\u7c97\u7cd9":"rough"};return{getModuleName:function(a){return d[a]||a},getEasyFun:function(f){return c[f]||f}}})}("psLib"),function(b){ShearPhoto[b].module("corrode",function(){return{process:function(v,u){var t,s,r,q,p,o,n,m,l;for(t=parseInt(u[0])||3,s=v.data,r=v.width,q=v.height,p=0;r>p;p++){for(o=0;q>o;o++){for(n=parseInt(2*Math.random()*t)-t,m=parseInt(2*Math.random()*t)-t,l=o*r+p,n=(o+n)*r+p+m,m=0;3>m;m++){s[4*l+m]=s[4*n+m]}}}return v}}})}("psLib"),function(b){ShearPhoto[b].module("curve",function(c){return{process:function(t,s){var r,q,p,o,n,m,l,a;for(r=c.lib.dorsyMath.lagrange(s[0],s[1]),q=t.data,p=t.width,o=t.height,n=0;p>n;n++){for(m=0;o>m;m++){for(l=m*p+n,a=0;3>a;a++){q[4*l+a]=r(q[4*l+a])}}}return t}}})}("psLib"),function(b){ShearPhoto[b].module("darkCorner",function(c){return{process:function(F,E){var D,C,B,A,z,y,x,w,v,u,t,s,r,a;for(D=parseInt(E[0])||3,C=E[1]||30,B=F.data,A=F.width,z=F.height,y=2*A/3,x=1*z/2,w=c.lib.dorsyMath.distance([y,x]),D=w*(1-D/10),v=0;A>v;v++){for(u=0;z>u;u++){for(t=u*A+v,s=0;3>s;s++){r=B[4*t+s],a=(c.lib.dorsyMath.distance([v,u],[y,x])-D)/(w-D),0>a&&(a=0),r=(0*Math.pow(1-a,3)+0.06*a*Math.pow(1-a,2)+3*0.3*a*a*(1-a)+1*Math.pow(a,3))*r*C/255,B[4*t+s]-=r}}}return F}}})}("psLib"),function(b){ShearPhoto[b].module("dorsyMath",function(d){var c={FFT1:function(h){function m(){var z,y,x,w,v,u,t,s,r,f,a;for(k++,z=l/Math.pow(2,k),y=l/z,x=0;z>x;x++){for(w=x*y,v=(x+1)*y-1,u=k,t=Math.pow(2,u-1),s=0;v-t>=w;w++){r=w+t,f=s*l/Math.pow(2,u),a=f+l/4,h[w] instanceof c.C||(h[w]=new c.C(h[w])),h[r] instanceof c.C||(h[r]=new c.C(h[r])),f=h[w].plus(h[r].mutiply(j[f])),a=h[w].plus(h[r].mutiply(j[a])),h[w]=f,h[r]=a,s++}}z>1&&m()}for(var l=h.length,k=0,j=[],i=0;l>i;i++){j[i]=this.exp(-2*Math.PI*i/l)}return m(),h},DFT:function(){},Matrix:function(h,g,l){var k,j,i=[];if(g){if(isNaN(g)?(k=/(\d+)\*/.exec(g)[1],g=/\*(\d+)/.exec(g)[1]):(k=g,g=l),h[0]&&h[0][0]){for(l=0;k>l;l++){for(i[l]=[],j=0;g>j;j++){i[l][j]=h[l][j]||0}}}else{for(l=0;k>l;l++){for(i[l]=[],j=0;g>j;j++){i[l][j]=h[l*g+j]||0}}}this.m=k,this.n=g}else{this.m=h.length,this.n=h[0].length}this.data=i},C:function(g,f){this.r=g||0,this.i=f||0},exp:function(f,h){f=f||0,h=h||1;var g=new c.C();return g.r=h*Math.cos(f),g.i=h*Math.sin(f),g},lagrange:function(g,f){var h=g.length;return function(n){var m,l,k,j,a;for(m=0,l=0;h>l;l++){for(k=1,j=1,a=0;h>a;a++){a!=l&&(k*=g[l]-g[a],j*=n-g[a])}m+=f[l]*(j/k)}return m}},applyMatrix:function(K,J,I){var H,G,F,E,D,C,B,A,z,y,x,w,v,u,a;for(I=I||0,H=K.data,G=K.width,F=J.length,J=new c.Matrix(J,F,1),E=[],D=-(Math.sqrt(F)-1)/2,C=0,B=H.length;B>C;C+=4){if(A=C/4,z=parseInt(A/G),y=A%G,0!=z&&0!=y){for(x=[[],[],[]],w=D;-D>=w;w++){for(v=z+w,u=D;-D>=u;u++){for(a=4*(v*G+(y+u)),A=0;3>A;A++){x[A].push(H[a+A])}}}for(z=new d.lib.dorsyMath.Matrix(x,3,F).mutiply(J),A=0;3>A;A++){E[C+A]=z.data[A]}E[C+4]=H[C+4]}}for(C=0,B=H.length;B>C;C++){E[C]&&(H[C]=E[C]<I?E[C]:H[C])}return K},RGBToHSI:function(g,f,j){var i=(g-f+g-j)/2/Math.sqrt((g-f)*(g-f)+(g-j)*(f-j))||0,i=Math.acos(i),i=j>f?2*Math.PI-i:i,h=1-3*Math.min(g,f,j)/(g+f+j);return i>2*Math.PI&&(i=2*Math.PI),0>i&&(i=0),{H:i,S:h,I:(g+f+j)/3}},HSIToRGB:function(h,g,l){if(0>h?(h%=2*Math.PI,h+=2*Math.PI):h%=2*Math.PI,h<=2*Math.PI/3){var k=l*(1-g),j=l*(1+g*Math.cos(h)/Math.cos(Math.PI/3-h)),i=3*l-(j+k)}else{h<=4*Math.PI/3?(h-=2*Math.PI/3,j=l*(1-g),i=l*(1+g*Math.cos(h)/Math.cos(Math.PI/3-h)),k=3*l-(i+j)):(h-=4*Math.PI/3,i=l*(1-g),k=l*(1+g*Math.cos(h)/Math.cos(Math.PI/3-h)),j=3*l-(i+k))}return{R:j,G:i,B:k}},applyInHSI:function(h,g){var l,k,j,i;for(l=h.data,k=0,j=l.length;j>k;k+=4){i=this.RGBToHSI(l[k],l[k+1],l[k+2]),g(i),1<i.S&&(i.S=1),0>i.S&&(i.S=0),i=this.HSIToRGB(i.H,i.S,i.I),l[k]=i.R,l[k+1]=i.G,l[k+2]=i.B}},applyInCoordinate:function(){},distance:function(f,g){return g=g||[0,0],f=new c.C(f[0],f[1]),g=new c.C(g[0],g[1]),f.minus(g).distance()},xyToIFun:function(f){return function(a,h,g){return 4*(h*f+a)+(g||0)}},xyCal:function(j,i,p,o,n){var m,l,k;for(m=this.xyToIFun(j.width),l=0;3>l;l++){k=m(i,p,l),j[k]=o(j[k])}n&&(j[k+1]=n(j[k+1]))}};return c.Matrix.prototype={plus:function(f){var i,h,g;if(this.m!=f.m||this.n!=f.n){throw Error("\u77e9\u9635\u52a0\u6cd5\u884c\u5217\u4e0d\u5339\u914d")}for(i=new c.Matrix([],this.m,this.n),h=0;h<this.m;h++){for(g=0;g<this.n;g++){i.data[h][g]=this.data[h][g]+f.data[h][g]}}return i},minus:function(f){var i,h,g;if(this.m!=f.m||this.n!=f.n){throw Error("\u77e9\u9635\u51cf\u6cd5\u6cd5\u884c\u5217\u4e0d\u5339\u914d")}for(i=new c.Matrix([],this.m,this.n),h=0;h<this.m;h++){for(g=0;g<this.n;g++){i.data[h][g]=this.data[h][g]-f.data[h][g]}}return i},mutiply:function(h){var m,l,k,j,i;if(this.n!=h.m){throw Error("\u77e9\u9635\u4e58\u6cd5\u884c\u5217\u4e0d\u5339\u914d")}for(m=new c.Matrix([],this.m,h.n),l=0;l<this.m;l++){for(k=0;k<h.n;k++){for(j=0,i=0;i<this.n;i++){j+=this.data[l][i]*h.data[i][k]}m.data[l][k]=j}}return m}},c.C.prototype={plus:function(f){var g=new c.C();return g.r=this.r+f.r,g.i=this.i+f.i,g},minus:function(f){var g=new c.C();return g.r=this.r-f.r,g.i=this.i-f.i,g},mutiply:function(f){var g=new c.C();return g.r=this.r*f.r-this.i*f.i,g.i=this.r*f.i+this.i*f.r,g},divide:function(f){var h=new c.C(),g=f.mutiply(f.conjugated());return f=this.mutiply(f.conjugated()),h.r=f.r/g.r,h.i=f.i/g.r,h},conjugated:function(){return new c.C(this.r,-this.i)},distance:function(){return Math.sqrt(this.r*this.r+this.i*this.i)}},c})}("psLib"),function(b){ShearPhoto[b].module("dotted",function(c){return{process:function(F,E){var D,C,B,A,z,y,x,w,v,u,t,s,r,a;for(D=parseInt(E[0])||1,C=parseInt(E[1])||1,B=F.data,A=F.width,z=F.height,y=2*D+1,x=[],w=C*C,C=-D;D>C;C++){for(v=-D;D>v;v++){C*C+v*v>w&&x.push([C,v])}}for(D=c.lib.dorsyMath.xyToIFun(A),C=0,A=parseInt(A/y);A>C;C++){for(v=0,w=parseInt(z/y);w>v;v++){for(u=parseInt((C+0.5)*y),t=parseInt((v+0.5)*y),s=0;s<x.length;s++){r=u+x[s][0],a=t+x[s][1],B[D(r,a,3)]=225,B[D(r,a,2)]=225,B[D(r,a,0)]=225,B[D(r,a,1)]=225}}}return F}}})}("psLib"),function(b){ShearPhoto[b].module("easy",function(){return{getFun:function(a){return{softenFace:function(){return this.clone().add(this.act("\u9ad8\u65af\u6a21\u7cca",10),"\u6ee4\u8272").act("\u4eae\u5ea6",-10,5)},sketch:function(){var c=this.act("\u7070\u5ea6\u5904\u7406").clone();return this.add(c.act("\u53cd\u8272").act("\u9ad8\u65af\u6a21\u7cca",8),"\u989c\u8272\u51cf\u6de1").act("\u9510\u5316",1)},softEnhancement:function(){return this.act("\u66f2\u7ebf",[0,190,255],[0,229,255])},purpleStyle:function(){var c=this.clone();return this.add(c.act("\u9ad8\u65af\u6a21\u7cca",3),"\u6b63\u7247\u53e0\u5e95","RG")},soften:function(){var c=this.clone();return this.add(c.act("\u9ad8\u65af\u6a21\u7cca",6),"\u53d8\u6697")},vintage:function(){return this.clone(),this.act("\u7070\u5ea6\u5904\u7406").add(ShearPhoto[b](this.canvas.width,this.canvas.height,"#808080").act("\u6dfb\u52a0\u6742\u8272").act("\u9ad8\u65af\u6a21\u7cca",4).act("\u8272\u76f8/\u9971\u548c\u5ea6\u8c03\u8282",32,19,0,!0),"\u53e0\u52a0")},gray:function(){return this.act("\u7070\u5ea6\u5904\u7406")},lomo:function(){return this.clone().add(this.clone(),"\u6ee4\u8272").add(this.clone(),"\u67d4\u5149").add(this.clone().act("\u53cd\u8272"),"\u6b63\u5e38","20%","B").act("\u6697\u89d2",6,200)},strongEnhancement:function(){return this.clone().add(this.clone().act("\u66f2\u7ebf",[0,50,255],[0,234,255]),"\u67d4\u5149")},strongGray:function(){return this.act("\u7070\u5ea6\u5904\u7406").act("\u66f2\u7ebf",[0,61,69,212,255],[0,111,176,237,255])},lightGray:function(){return this.act("\u7070\u5ea6\u5904\u7406").act("\u66f2\u7ebf",[0,60,142,194,255],[0,194,240,247,255])},warmAutumn:function(){var c=this.clone().act("\u8272\u76f8/\u9971\u548c\u5ea6\u8c03\u8282",36,47,8,!0).act("\u6697\u89d2",6,150);return this.add(c,"\u53e0\u52a0")},carveStyle:function(){var c=this.clone().act("\u9a6c\u8d5b\u514b").act("\u67e5\u627e\u8fb9\u7f18").act("\u6d6e\u96d5\u6548\u679c");return this.add(c,"\u7ebf\u6027\u5149")},rough:function(){return this.add(ShearPhoto[b](this.canvas.width,this.canvas.height,"#000").act("\u55b7\u70b9").act("\u53cd\u8272").act("\u6d6e\u96d5\u6548\u679c"),"\u53e0\u52a0")}}[a]}}})}("psLib"),function(b){ShearPhoto[b].module("embossment",function(){return{process:function(t){var s,r,q,p,o,n,m,l,k;for(s=t.data,r=t.width,q=[],p=0,o=s.length;o>p;p+=4){if(n=p/4,m=parseInt(n/r),l=n%r,n=4*((m-1)*r+(l-1)),k=4*(m+1)*r+4*(l+1),0!=m&&0!=l){for(m=0;3>m;m++){q[p+m]=s[n+m]-s[k+m]+127.5}q[p+4]=s[p+4]}}for(p=0,o=s.length;o>p;p++){s[p]=q[p]||s[p]}return t}}})}("psLib"),function(b){ShearPhoto[b].module("gaussBlur",function(){return{process:function(B,A,z){var y,x,w,v,u,t,s=B.data,r=B.width,q=B.height,p=[],o=0;for(A=Math.floor(A)||3,z=z||A/3,y=1/(Math.sqrt(2*Math.PI)*z),v=-1/(2*z*z),u=0,z=-A;A>=z;z++,u++){w=y*Math.exp(v*z*z),p[u]=w,o+=w}for(u=0,z=p.length;z>u;u++){p[u]/=o}for(y=0;q>y;y++){for(z=0;r>z;z++){for(o=x=w=v=0,t=-A;A>=t;t++){u=z+t,u>=0&&r>u&&(u=4*(y*r+u),x+=s[u]*p[t+A],w+=s[u+1]*p[t+A],v+=s[u+2]*p[t+A],o+=p[t+A])}u=4*(y*r+z),s[u]=x/o,s[u+1]=w/o,s[u+2]=v/o}}for(z=0;r>z;z++){for(y=0;q>y;y++){for(o=x=w=v=0,t=-A;A>=t;t++){u=y+t,u>=0&&q>u&&(u=4*(u*r+z),x+=s[u]*p[t+A],w+=s[u+1]*p[t+A],v+=s[u+2]*p[t+A],o+=p[t+A])}u=4*(y*r+z),s[u]=x/o,s[u+1]=w/o,s[u+2]=v/o}}return B.data=s,B}}})}("psLib"),function(b){ShearPhoto[b].module("borderline",function(c){return{process:function(a){return c.lib.dorsyMath.applyMatrix(a,[0,1,0,1,-4,1,0,1,0],250)}}})}("psLib"),function(b){ShearPhoto[b].module("mosaic",function(){return{process:function(D,C){var B,A,z,y,x,w,v,u,t,s,r,q,p;for(B=parseInt(C[0])||3,A=D.data,z=D.width,y=D.height,B=2*B+1,x=0,w=parseInt(z/B);w>x;x++){for(v=0,u=parseInt(y/B);u>v;v++){for(t=[],s=[0,0,0],r=0;B>r;r++){for(q=0;B>q;q++){p=(v*B+r)*z+x*B+q,s[0]+=A[4*p],s[1]+=A[4*p+1],s[2]+=A[4*p+2]}}for(t[0]=s[0]/(B*B),t[1]=s[1]/(B*B),t[2]=s[2]/(B*B),r=0;B>r;r++){for(q=0;B>q;q++){p=(v*B+r)*z+x*B+q,A[4*p]=t[0],A[4*p+1]=t[1],A[4*p+2]=t[2]}}}}return D}}})}("psLib"),function(b){ShearPhoto[b].module("noise",function(){return{process:function(v,u){var t,s,r,q,p,o,n,m,l;for(t=parseInt(u[0])||100,s=v.data,r=v.width,q=v.height,p=0;r>p;p++){for(o=0;q>o;o++){for(n=o*r+p,m=0;3>m;m++){l=parseInt(2*Math.random()*t)-t,s[4*n+m]+=l}}}return v}}})}("psLib"),function(b){ShearPhoto[b].module("oilPainting",function(){return{process:function(v,u){var t,s,r,q,p,o,n,m,l;for(t=parseInt(u[0])||16,s=v.data,r=v.width,q=v.height,p=0;r>p;p++){for(o=0;q>o;o++){for(n=o*r+p,m=0,l=0;3>l;l++){m+=s[4*n+l]}for(m/=3,m=parseInt(m/t)*t,l=0;3>l;l++){s[4*n+l]=m}}}return v}}})}("psLib"),function(b){ShearPhoto[b].module("setHSI",function(c){return{process:function(a,d){return d[0]=d[0]/180*Math.PI,d[1]=d[1]/100||0,d[2]=255*(d[2]/100)||0,d[3]=d[3]||!1,c.lib.dorsyMath.applyInHSI(a,function(f){d[3]?(f.H=d[0],f.S=d[1]):(f.H+=d[0],f.S+=d[1]),f.I+=d[2]}),a}}})}("psLib"),function(b){ShearPhoto[b].module("sharp",function(){return{process:function(v,u){var t,s,r,q,p,o,n,m,l;for(t=u[0]||0.6,s=v.data,r=v.width,q=0,p=s.length;p>q;q+=4){if(o=q/4,n=parseInt(o/r),m=o%r,0!=n&&0!=m){for(l=4*((n-1)*r+(m-1)),n=4*((n-1)*r+m),o=4*(o-1),m=0;3>m;m++){s[q+m]+=(s[q+m]-(s[n+m]+s[o+m]+s[l+m])/3)*t}}}return v}}})}("psLib"),function(b){ShearPhoto[b].module("toGray",function(){return{process:function(g){var f,j,i,h;for(f=g.data,j=0,i=f.length;i>j;j+=4){h=parseInt((f[j]+f[j+1]+f[j+2])/3),f[j+2]=f[j+1]=f[j]=h}return g.data=f,g}}})}("psLib"),function(b){ShearPhoto[b].module("toReverse",function(){return{process:function(g){for(var f=g.data,i=0,h=f.length;h>i;i+=4){f[i]=255-f[i],f[i+1]=255-f[i+1],f[i+2]=255-f[i+2]}return g.data=f,g}}})}("psLib"),function(b){ShearPhoto[b].module("toThresh",function(c){return{process:function(a,j){var i,h,g;for(a=c.lib.toGray.process(a),i=a.data,j=j[0]||128,h=0,g=i.length;g>h;h++){(h+1)%4&&(i[h]=i[h]>j?255:0)}return a.data=i,a}}})}("psLib")}catch(e){};
